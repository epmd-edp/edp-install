# Copyright 2018 EPAM Systems.

# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.

# See the License for the specific language governing permissions and
# limitations under the License.

---
# file: group_vars/all
ansible_connection: ssh
work_dir: "/opt/edp"
post_integration_dir: "{{ work_dir }}/post-integration"
secrets_dir: "{{ work_dir }}/secrets"
templates_dir: "{{ work_dir }}/oc-templates"
files_dir: "{{ work_dir }}/files"
projects_suffix: ""
projects_list: [
    "{{ (projects_suffix != '') | ternary('edp-cockpit-', 'edp-cockpit')}}{{ projects_suffix }}",
    "{{ (projects_suffix != '') | ternary('edp-cicd-', 'edp-cicd')}}{{ projects_suffix }}"
    ]
project_cicd: "{{ (projects_suffix != '') | ternary('edp-cicd-', 'edp-cicd')}}{{ projects_suffix }}"
project_cockpit: "{{ (projects_suffix != '') | ternary('edp-cockpit-', 'edp-cockpit')}}{{ projects_suffix }}"
project_vcs_edp: "{{ (projects_suffix != '') | ternary('edp-', 'edp')}}{{ projects_suffix }}"
ocadm: "oc --config=/etc/origin/master/admin.kubeconfig"
vcs_ssh_port: "{{ vcs_ssh_port | default('7999') }}"
mr_deploy: "{{ (lookup('env', 'MR_DEPLOY') == 'true') | ternary('true', 'false') }}"
secrets:
  sonar_admin:
    password: admin
  nexus_admin:
    password: admin123
  gerrit_admin:
    password: secret
    email: admin@example.com
  gerrit_db:
    db_name: gerrit
    db_user: gerrit
    db_password: gerrit
  sonar_db:
    db_name: sonar
    db_user: sonar
    db_password: sonar
  vcs_oauth:
    id: "{{ vcs_oauth_app_id }}"
    secret: "{{ vcs_oauth_app_secret }}"
  keycloak_db:
    db_user: keycloak
    db_password: keycloak
tools:
  jenkins:
    web_url: "https://jenkins-{{ project_cicd }}.{{ dns_wildcard | default('main.edp.projects.epam.com') }}"
    password: "{{ jenkins_password | default('password') }}"
    fs_type: "{{ jenkins_fs_type | default('gluster') }}"
    host_path_volume: "{{ jenkins_host_path_volume | default('/opt/data/jenkins') }}"
    service_name: "{{ jenkins_service_name | default('jenkins') }}"
    enable_oauth: "{{ jenkins_enable_oauth | default('false') }}"
    volume_capacity: "{{ jenkins_volume_capacity | default('5Gi') }}"
    maven_cache_volume_capacity: "{{ jenkins_maven_cache_volume_capacity | default('5Gi') }}"
    frontend_image: "{{ jenkins_frontend_image | default('docker-registry-default.main.edp.projects.epam.com/infra/edp-ui-slave:latest') }}"
    backend_image: "{{ jenkins_backend_image | default('openshift/jenkins-slave-maven-centos7') }}"
    jenkins_image: "{{ jenkins_image_version | default('docker-registry-default.main.edp.projects.epam.com/infra/edp-jenkins:latest') }}"
  gerrit:
    version: "{{ gerrit_version | default('2.14.8') }}"
    auth_type: "{{ gerrit_auth_type | default('OAUTH') }}"
    volume_capacity: "{{ gerrit_volume_capacity | default('5Gi') }}"
    volume_db_capacity: "{{ gerrit_volume_db_capacity | default('2Gi') }}"
    web_url: "http://gerrit-{{ project_cicd }}.{{ dns_wildcard | default('main.edp.projects.epam.com') }}"
  nexus:
    version: "{{ nexus_version | default('3.6.2') }}"
    volume_capacity: "{{ nexus_volume_capacity | default('5Gi') }}"
    repos_npm_defaults:
      blob_store: default # Note : cannot be updated once the repo has been created
      strict_content_validation: true
      version_policy: mixed # release, snapshot or mixed
      layout_policy: strict # strict or permissive
      write_policy: allow # allow_once or allow
    privilege_defaults:
      type: repository-view
      format: maven2
      actions:
        - read
    repos_npm_blob:
      - name: npm
        path: /nexus-data/blobs/npm
    repos_npm_proxy:
      - name: npm-proxy
        blob_store: "npm"
        remote_url: https://registry.npmjs.org
    repos_npm_hosted:
      - name: npm-internal
        blob_store: "npm"
    repos_npm_group:
      - name: npm-all
        blob_store: "npm"
        member_repos:
          - npm-internal
          - npm-proxy
    roles:
      - id: nexus-rw
        name: nexus-rw
        description: Jenkins-CI
        privileges:
          - nx-search-read
          - nx-repository-view-*-*-read
          - nx-repository-view-*-*-browse
          - nx-repository-view-*-*-add
          - nx-repository-view-*-*-edit
          - nx-apikey-all
        roles: []
    local_users:
      - username: jenkins
        jenkins_id: nexus
        first_name: Jenkins
        last_name: CI
        email: jenkins@edp.com
        password: "jenkins"
        roles:
          - nexus-rw
  sonar:
    version: "{{ sonar_version | default('7.1') }}"
    volume_capacity: "{{ sonar_volume_capacity | default('1Gi') }}"
    volume_db_capacity: "{{ sonar_volume_db_capacity | default('2Gi') }}"
    profiles:
      - { name: "EDP way", filename: 'quality-profile.xml' }
  cockpit:
    version: "{{ cockpit_version | default('docker-registry-default.main.edp.projects.epam.com/infra/edp-cockpit:snapshot') }}"
    enable_msra_quickstart: "{{ cockpit_enable_msra_quickstart | default('true') }}"
    openshift_trust_certificates: "true"
  keycloak:
    image: "{{ keycloak_image | default('jboss/keycloak:3.4.3.Final') }}"
    volume_db_capacity: "{{ keycloak_volume_db_capacity | default('2Gi') }}"
    realm_name: "{{ keycloak_realm_name | default('CI') }}"
    web_url: "http://keycloak-{{ project_cockpit }}.{{ dns_wildcard | default('main.edp.projects.epam.com') }}"
